# Praise Todo 開発ガイドライン

## 開発フロー

本プロジェクトは以下の開発フローに従って進めます：

1. **仕様確認**: 実装前に`docs/specification.md`と`docs/features.md`を確認し、要件を理解する
2. **テストケース決定**: 重要な機能のみテストケースを事前に決める（頻繁に修正する部分のテストは後回し）
3. **実装**: クリーンアーキテクチャの原則に従って実装する
4. **テストコード作成**: 実装と同時にテストコードも作成する
5. **テスト実行**: テストを実行してエラーがないか確認
6. **エラー修正**: エラーが出たら修正する
7. **動作確認**: 画面の動作を確認する
8. **仕様修正**: 思ったのと違ったら`docs/specification.md`を修正する
9. **テスト修正**: 仕様変更に合わせてテストも修正する
10. **反復**: 3に戻って繰り返す

## アーキテクチャ原則

- **クリーンアーキテクチャ**: `docs/architecture.md`に従う
- **レイヤー分離**: Domain → Application → Infrastructure → Presentation の依存関係を守る
- **依存性逆転**: インターフェースを通じて依存関係を定義する
- **単一責任**: 各クラス・モジュールは1つの責任のみを持つ

## ディレクトリ構造

```
src/
├── domain/          # Domain層（エンティティ、値オブジェクト、ビジネスルール）
├── application/     # Application層（ユースケース、インターフェース、DTO）
├── infrastructure/ # Infrastructure層（リポジトリ実装、データベース、外部サービス）
└── presentation/   # Presentation層（Reactコンポーネント、Next.jsページ、フック）
```

## 実装時の注意点

### コードスタイル
- TypeScriptの型安全性を重視する
- エラーハンドリングを適切に実装する
- コメントは必要最小限（コードで表現できることはコードで表現）

### テスト戦略
- **重要な機能**: 必ずテストケースを作成する
- **頻繁に修正する部分**: テストは後回しにする（開発速度を優先）
- テストコードは実装と同時に作成する
- 単体テスト、統合テスト、E2Eテストを適切に使い分ける

### エラーハンドリング
- エラーは適切な型で定義する（`Error`クラスを継承）
- ユーザーに分かりやすいエラーメッセージを表示する
- ログを適切に記録する

### データベース
- Prismaスキーマは`docs/database-schema.md`に従う
- マイグレーションは慎重に実行する
- トランザクションを適切に使用する

### セキュリティ対策

#### 認証・認可
- Supabase認証を使用する（必要に応じて）
- ユーザーごとのデータ分離を実装する
- Row Level Security（RLS）ポリシーを適切に設定する
- 認証済みユーザーのみがデータにアクセスできるようにする

#### 入力検証・サニタイゼーション
- **Domain層**: ビジネスルールに基づくバリデーションを実装
- **Application層**: DTOレベルでの追加検証を実装
- **Presentation層**: フォーム入力時の即座のバリデーション
- すべてのユーザー入力は検証・サニタイズする
- 文字数制限、型チェック、必須項目チェックを実装

#### SQLインジェクション対策
- Prismaを使用することで自動的に対策される
- 生のSQLクエリは使用しない（Prismaクエリビルダーを使用）
- パラメータ化クエリを使用する

#### XSS（Cross-Site Scripting）対策
- Reactのデフォルトのエスケープ機能を活用
- `dangerouslySetInnerHTML`は使用しない（やむを得ない場合は厳重にサニタイズ）
- ユーザー入力データをそのままHTMLに出力しない
- Content Security Policy（CSP）を設定する

#### CSRF（Cross-Site Request Forgery）対策
- Next.jsのCSRF保護機能を活用
- SameSite Cookie属性を設定する
- 重要な操作にはトークンを使用する

#### データ保護
- 機密情報（パスワード、トークンなど）は環境変数に保存
- 環境変数は`.env.local`に保存し、`.gitignore`に追加
- データベース接続情報は環境変数で管理
- ログに機密情報を出力しない

#### セキュリティヘッダー
- Next.jsのセキュリティヘッダーを設定
- HTTPSを強制する
- X-Frame-Options、X-Content-Type-Optionsなどを設定

#### エラーハンドリング
- エラーメッセージに機密情報を含めない
- スタックトレースは本番環境では表示しない
- 適切なエラーログを記録する

#### セキュリティレビュー
- プルリクエスト時にはセキュリティチェックを実施
- 認証・認可の実装を確認
- 入力検証の実装を確認
- データアクセス制御を確認

## 実装手順

1. **仕様確認**: `docs/specification.md`と`docs/features.md`を読む
2. **設計**: どのレイヤーに何を実装するか考える
3. **実装**: クリーンアーキテクチャの原則に従って実装
4. **テスト**: テストコードを作成・実行
5. **動作確認**: 画面で動作を確認
6. **仕様修正**: 必要に応じて仕様書を更新

## プルリクエスト

- プルリクエスト時には人の目でコードを確認する
- コードレビューを必ず実施する
- 仕様書の変更があれば`docs/specification.md`を更新する

## 技術スタック

- **フレームワーク**: Next.js 16
- **UIライブラリ**: React 19
- **言語**: TypeScript
- **スタイリング**: Tailwind CSS
- **データベース**: Supabase（PostgreSQL）
- **ORM**: Prisma
- **パッケージマネージャー**: pnpm

