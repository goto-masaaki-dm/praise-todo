# 機能詳細仕様書

## 概要

本ドキュメントでは、Praise Todoアプリケーションの各機能の詳細な動作仕様を定義します。

## 1. タスク管理機能

### 1.1 タスクの追加

#### 機能概要
ユーザーが新しいタスクを作成できる機能。

#### 動作仕様

1. **タスク作成フォームの表示**
   - 「タスクを追加」ボタンをクリックすると、タスク作成フォームが表示される
   - モーダルまたはインライン形式で表示

2. **必須項目の入力**
   - タイトル: 必須（最大200文字）
   - その他の項目はオプション

3. **オプション項目の入力**
   - 説明: 任意（最大2000文字）
   - 優先度: デフォルトは「中」（低・中・高・緊急から選択）
   - 期限: 日時ピッカーで選択可能
   - カテゴリ: 既存のカテゴリから選択、または新規作成
   - タグ: 複数選択可能、新規作成も可能
   - メモ: 任意のテキスト

4. **バリデーション**
   - タイトルが空の場合はエラーメッセージを表示
   - 文字数制限を超えた場合はエラーメッセージを表示

5. **保存処理**
   - 「保存」ボタンをクリックすると、データベースに保存
   - 保存成功時は成功メッセージを表示
   - 保存失敗時はエラーメッセージを表示

6. **オフライン対応**
   - オフライン時はローカルストレージに保存
   - オンライン復帰時に自動的に同期

### 1.2 タスクの編集

#### 機能概要
既存のタスクを編集できる機能。

#### 動作仕様

1. **編集モードの開始**
   - タスクカードの「編集」ボタンをクリック
   - またはタスクをダブルクリック

2. **編集フォームの表示**
   - タスク作成フォームと同じUI
   - 既存の値がフォームに自動入力される

3. **変更の保存**
   - 「保存」ボタンで変更を保存
   - 「キャンセル」ボタンで変更を破棄

4. **リアルタイム更新**
   - 保存後、タスクリストが自動的に更新される

### 1.3 タスクの削除

#### 機能概要
不要なタスクを削除できる機能。

#### 動作仕様

1. **削除の開始**
   - タスクカードの「削除」ボタンをクリック
   - 確認ダイアログが表示される

2. **確認処理**
   - 「削除」を選択すると削除実行
   - 「キャンセル」を選択すると削除を中止

3. **削除処理**
   - データベースからタスクを削除
   - 関連するサブタスク、タグ、メモも削除（Cascade）

4. **削除後の処理**
   - タスクリストから即座に削除
   - 成功メッセージを表示

### 1.4 タスクの完了

#### 機能概要
タスクを完了状態に変更できる機能。

#### 動作仕様

1. **完了処理**
   - タスクカードのチェックボックスをクリック
   - または「完了」ボタンをクリック

2. **状態の更新**
   - `completed`フラグを`true`に更新
   - `completedAt`に現在の日時を記録

3. **賞賛の表示**
   - ユーザー設定で有効な場合、賞賛メッセージとアニメーションを表示
   - ポイントを付与（設定に応じて）

4. **完了タスクの表示**
   - 完了したタスクは視覚的に区別（グレーアウト、取り消し線など）
   - フィルターで非表示にすることも可能

### 1.5 優先度設定

#### 機能概要
タスクに優先度を設定できる機能。

#### 動作仕様

1. **優先度の選択**
   - タスク作成・編集時に優先度を選択
   - 選択肢: 低・中・高・緊急

2. **視覚的表現**
   - 優先度に応じて色分け表示
   - アイコンで視覚的に区別

3. **ソート機能**
   - 優先度順でソート可能

### 1.6 期限設定

#### 機能概要
タスクに期限を設定できる機能。

#### 動作仕様

1. **期限の設定**
   - 日時ピッカーで期限を選択
   - 時間も指定可能

2. **期限の表示**
   - 期限が近づくと警告表示
   - 期限を過ぎたタスクは強調表示

3. **通知機能**（将来実装）
   - 期限が近づいたら通知

### 1.7 カテゴリ分類

#### 機能概要
タスクをカテゴリで分類できる機能。

#### 動作仕様

1. **カテゴリの作成**
   - 「カテゴリを追加」から新規カテゴリを作成
   - カテゴリ名、色、アイコンを設定可能

2. **カテゴリの選択**
   - タスク作成・編集時にカテゴリを選択
   - ドロップダウンまたはモーダルで選択

3. **カテゴリ別表示**
   - カテゴリでフィルター可能
   - カテゴリ別の進捗を表示

### 1.8 タグ機能

#### 機能概要
タスクに複数のタグを付与できる機能。

#### 動作仕様

1. **タグの作成**
   - タスク作成・編集時にタグを入力
   - 既存のタグから選択、または新規作成

2. **タグの表示**
   - タスクカードにタグを表示
   - タグごとに色分け

3. **タグでフィルター**
   - タグをクリックすると、そのタグのタスクのみ表示

### 1.9 サブタスク

#### 機能概要
タスクにサブタスクを追加できる機能。

#### 動作仕様

1. **サブタスクの追加**
   - タスク詳細画面でサブタスクを追加
   - 「サブタスクを追加」ボタンで追加

2. **サブタスクの管理**
   - 各サブタスクを個別に完了可能
   - ドラッグ&ドロップで順序変更

3. **進捗の表示**
   - サブタスクの完了率を表示
   - 全てのサブタスクが完了すると親タスクも自動完了（オプション）

### 1.10 メモ・詳細情報

#### 機能概要
タスクに詳細なメモを追加できる機能。

#### 動作仕様

1. **メモの追加**
   - タスク詳細画面でメモを追加
   - マークダウン形式に対応（将来実装）

2. **メモの表示**
   - タスクカードにメモのプレビューを表示
   - 詳細画面で全文を表示

### 1.11 フィルター・ソート機能

#### 機能概要
タスクを様々な条件でフィルター・ソートできる機能。

#### 動作仕様

1. **フィルター機能**
   - 完了状態: 全て・未完了・完了
   - 優先度: 全て・低・中・高・緊急
   - カテゴリ: 全て・特定のカテゴリ
   - タグ: 全て・特定のタグ
   - 期限: 全て・期限あり・期限切れ・期限が近い

2. **ソート機能**
   - 作成日時: 新しい順・古い順
   - 更新日時: 新しい順・古い順
   - 期限: 近い順・遠い順
   - 優先度: 高い順・低い順
   - タイトル: あいうえお順・逆順

3. **複合条件**
   - 複数のフィルター条件を組み合わせ可能
   - フィルター条件を保存（将来実装）

## 2. 賞賛・モチベーション機能

### 2.1 励ましメッセージの表示

#### 機能概要
タスク完了時やマイルストーン達成時に励ましメッセージを表示する機能。

#### 動作仕様

1. **メッセージの種類**
   - タスク完了時: 「お疲れ様でした！」「素晴らしい！」など
   - マイルストーン達成時: 「10タスク完了おめでとうございます！」など
   - 連続日数達成時: 「7日連続達成！継続は力なり！」など

2. **表示タイミング**
   - ユーザー設定に応じて表示
   - モーダルまたはトースト通知で表示

3. **メッセージのランダム化**
   - 同じ状況でも異なるメッセージを表示
   - メッセージプールからランダムに選択

### 2.2 アニメーション・エフェクト

#### 機能概要
視覚的なフィードバックを提供するアニメーション機能。

#### 動作仕様

1. **アニメーションの種類**
   - タスク完了時: チェックマークアニメーション、花火エフェクト
   - マイルストーン達成時: 特別なアニメーション
   - 連続日数達成時: カウントアップアニメーション

2. **パフォーマンス**
   - 軽量なアニメーションを使用
   - ユーザー設定で無効化可能

3. **アクセシビリティ**
   - アニメーションを無効化する設定を提供
   - prefers-reduced-motionに対応

### 2.3 ポイント・スコアシステム

#### 機能概要
タスク完了に応じてポイントを付与する機能。

#### 動作仕様

1. **ポイントの付与**
   - タスク完了時にポイントを付与
   - 優先度に応じてポイントを調整:
     - 低: 10ポイント
     - 中: 20ポイント
     - 高: 30ポイント
     - 緊急: 50ポイント

2. **ポイントの表示**
   - ヘッダーに累計ポイントを表示
   - ポイント獲得時に通知を表示

3. **ポイント履歴**
   - ポイントの獲得履歴を表示（将来実装）
   - ポイントの消費機能（将来実装）

### 2.4 バッジ・実績システム

#### 機能概要
特定の条件を満たすとバッジを獲得できる機能。

#### 動作仕様

1. **バッジの種類**
   - 初めてのタスク完了: 「スタート」
   - 10タスク完了: 「デビュー」
   - 50タスク完了: 「ベテラン」
   - 100タスク完了: 「マスター」
   - 7日連続: 「1週間の継続」
   - 30日連続: 「1ヶ月の継続」
   - 全カテゴリ制覇: 「カテゴリマスター」

2. **バッジの獲得**
   - 条件を満たすと自動的にバッジを獲得
   - 獲得時に通知を表示

3. **バッジの表示**
   - プロフィール画面で獲得したバッジを一覧表示
   - バッジの説明も表示

### 2.5 連続日数カウント（ストリーク）

#### 機能概要
毎日タスクを完了すると連続日数がカウントされる機能。

#### 動作仕様

1. **ストリークの更新**
   - 1日に少なくとも1つのタスクを完了するとストリークが更新
   - 連続でタスクを完了しないとストリークがリセット

2. **ストリークの表示**
   - ヘッダーに現在のストリークを表示
   - 最長ストリークも表示

3. **ストリークの維持**
   - ストリークが途切れそうな時にリマインダーを表示（将来実装）

## 3. 進捗追跡機能

### 3.1 タスク完了率の計算

#### 機能概要
全体およびカテゴリ別のタスク完了率を計算・表示する機能。

#### 動作仕様

1. **全体の完了率**
   - 完了タスク数 / 全タスク数 × 100
   - ダッシュボードに表示

2. **カテゴリ別の完了率**
   - 各カテゴリごとの完了率を計算
   - カテゴリ一覧に表示

3. **期間別の完了率**
   - 日・週・月単位での完了率を追跡
   - グラフで可視化

### 3.2 連続実行日数の追跡

#### 機能概要
毎日タスクを完了した日数を追跡する機能。

#### 動作仕様

1. **日数のカウント**
   - 1日に少なくとも1つのタスクを完了するとカウント
   - 連続でタスクを完了しないとリセット

2. **記録の保存**
   - 現在のストリークと最長ストリークを記録
   - データベースに保存

### 3.3 累計完了タスク数の記録

#### 機能概要
これまでに完了したタスクの総数を記録する機能。

#### 動作仕様

1. **カウントの更新**
   - タスクを完了するたびにカウントを増加
   - データベースに保存

2. **マイルストーンの表示**
   - 10、50、100、500、1000などのマイルストーンを表示
   - マイルストーン達成時に特別な賞賛を表示

### 3.4 カテゴリ別進捗の可視化

#### 機能概要
各カテゴリの進捗を可視化する機能。

#### 動作仕様

1. **進捗の表示**
   - 各カテゴリの完了タスク数を表示
   - 進捗バーで視覚的に表示

2. **グラフ表示**
   - 円グラフや棒グラフでカテゴリ別の進捗を表示
   - 期間別の比較も可能

### 3.5 時間ベースの進捗

#### 機能概要
特定の期間でのタスク完了数を追跡する機能。

#### 動作仕様

1. **期間の設定**
   - 1週間、1ヶ月などの期間を選択
   - カスタム期間も設定可能

2. **目標の設定**
   - 期間ごとの目標タスク数を設定
   - 例：「1週間で10タスク完了」

3. **進捗の表示**
   - 現在の進捗と目標を比較表示
   - 達成率を表示

## 4. 賞賛タイミング設定

### 4.1 設定機能

#### 機能概要
賞賛を表示するタイミングをユーザーが設定できる機能。

#### 動作仕様

1. **設定項目**
   - タスク完了時の賞賛: ON/OFF
   - マイルストーン達成時の賞賛: ON/OFF
   - 連続日数達成時の賞賛: ON/OFF
   - 1日の終わりのサマリー: ON/OFF
   - 1日の最初のタスク完了時の賞賛: ON/OFF
   - 全てのタスク完了時の賞賛: ON/OFF

2. **設定の保存**
   - 設定をデータベースに保存
   - 次回ログイン時も設定が保持される

3. **設定の適用**
   - 設定変更後、即座に反映される

## 5. UI/UX機能

### 5.1 レスポンシブデザイン

#### 機能概要
様々な画面サイズに対応したデザイン。

#### 動作仕様

1. **ブレークポイント**
   - モバイル: 640px以下
   - タブレット: 641px〜1024px
   - デスクトップ: 1025px以上

2. **レイアウトの調整**
   - 画面サイズに応じてレイアウトを変更
   - モバイルでは1カラム、デスクトップでは複数カラム

### 5.2 ダークモード対応

#### 機能概要
ライトモードとダークモードを切り替えられる機能。

#### 動作仕様

1. **モードの切り替え**
   - 設定画面でモードを切り替え
   - またはヘッダーのトグルボタンで切り替え

2. **設定の保存**
   - 選択したモードをデータベースに保存
   - 次回ログイン時もモードが保持される

3. **システム設定との連携**
   - システムの設定に従うオプション（将来実装）

## 6. データ同期機能

### 6.1 ローカルストレージとの連携

#### 機能概要
オフライン時もアプリを使用できるように、ローカルストレージにデータを保存する機能。

#### 動作仕様

1. **オフライン時の動作**
   - オフライン時はローカルストレージに保存
   - オンライン復帰時に自動的に同期

2. **同期処理**
   - ローカルストレージのデータをSupabaseに送信
   - 競合解決は「最後の書き込みが優先」

3. **同期状態の表示**
   - 同期中はインジケーターを表示
   - 同期エラー時はエラーメッセージを表示

## 7. エラーハンドリング

### 7.1 エラー処理

#### 機能概要
アプリケーションで発生するエラーを適切に処理する機能。

#### 動作仕様

1. **エラーの種類**
   - ネットワークエラー: オフライン時の処理
   - バリデーションエラー: 入力値の検証エラー
   - サーバーエラー: データベースエラーなど

2. **エラーメッセージの表示**
   - ユーザーに分かりやすいエラーメッセージを表示
   - エラーの詳細は開発者向けにログに記録

3. **エラーからの回復**
   - 可能な限り自動的に回復を試みる
   - ユーザーに再試行を促す



